---
layout: post
title: 如何定义机器人的状态?
---

用户与机器人的交互，就是机器人根据用户的输入而自身的一系列系统状态变化再影响用户输入的过程。

当前大部分的消费级机器人是基于安卓系统开发的，对于带屏幕的机器人，其人机界面大都是对Android系统上launcher的定制开发。我们可以将机器人系统与手机系统做一个类比。笼统地说手机系统从状态上看包含了关机、待机、解锁、锁屏状态，同样的机器人有睡觉、休息、工作、准备状态与手机系统一一对应，并对应于不同的页面。

基于安卓系统的机器人状态示例：
![基于安卓系统的机器人状态图](/assets/robot/state diagram of a android base robot.png)

将状态梳理出来之后，需要完善状态的切换规则。包括初始化表现、状态的进入方式及表现和解除方式及表现。
![基于安卓系统的机器人状态表](/assets/robot/state table of a android base robot.png)

对于无屏幕机器人，可以从语音的状态开始梳理。唤醒、待唤醒、不同的skill、低电量、充电...其人机界面则是由动作、语音、表情组成的多模态人机界面。

更为复杂的是，在交互过程中，机器人的状态存在被打断的场景。需要设计相应的打断规则。
机器端有各种全局打断，全局打断会对正在运行的模块造成影响，且各种全局打断也会有相互之间的影响，因此有必要做整体需求输出。局部打断可以视为全局打断在部分模块中不产生影响的一种变形，因此全局打断包含了局部打断。
一个模块的逻辑自洽性表现在三个方面：1）模块自身的自洽；2）该模块对其他模块的影响；3）其他模块对该模块的影响。
因此在设计的过程中，需要形成整体打断需求/交互规则：
1. 慎用全局打断
全局打断开发成本较大，会带来复杂度的整体上升，需要关注该全局打断是否有足够收益。
2. 确认打断源
- 软件模块可能成为打断源，如语音模块等。
- 软件态，如由功能引起的系统状态变化等。
- 硬件输入源，如开关机键等。
- 硬件态，如低电量等。    
- 其他打断源。 
3. 确认打断优先级
- 给出各全局打断的优先级强制排序且不得出现并列。
4. 打断执行策略
- 不能立即执行，需要等待条件满足才能执行的
- 不能立即执行，需要丢弃的，如语音
- 有时效性的，后者覆盖前者的，如蓝牙
- 其他
5. 全局打断对各模块的影响
考虑该全局打断对其他模块的影响，有的时候概括性的描述会导致细节上的冲突，建议做出以下描述
- 任意模块
- 大多数，请表述为任意模块除了
- 少部分，请列举
6. 各模块受到全局打断时的表现
- 如某些功能受到语音模块全局打断时，该功能模块的表现；或者如开机流程模块不被打断。
7. 打断所受到的技术侧限制
- 部分系统受到硬件或者底层的限制，可能无法在被打断时保持姿态，如动作。需要及时咨询技术侧，以便打断方案技术侧可行。或者技术侧根据产品需求做进一步的反馈。

而打断逻辑的核心问题：1：谁可以打断我（优先级）2、我会有什么反应（界面表现和功能逻辑），具体如下：
1. （谁可以打断我）：
- 对于任意一个功能A，需要明确它可以被哪些其他功能打断，即功能的优先级；
- 对于打断源，可以分为提示消息打断、功能打断和无操作三类；
- 对于任意任务，都需要为每个功能标明受到不同打断源的打断反应；
2. （我会有什么反应 ）： 
- 若我被其他功能打断，当前功能会有三种反应，后台运行，功能暂停，功能结束；
- 功能被打断的反应，分为打断时当前功能的反应以及打断源消失后当前功能的反应；

状态是机器人系统的“骨骼”，而界面则是存在这“骨骼”之上的“皮肤”。
可以说机器人状态是机器人设计最重要的模块之一。

